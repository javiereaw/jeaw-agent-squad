# AGENTS.MD - JEAW Agent Squad

## IRON LAWS (Memorize these - repeated at end)

```
1. IDENTIFY    â†’ Start work responses with [emoji agent-name] -- reason
2. SKILL FIRST â†’ Read .agent/skills/{agent}/SKILL.md BEFORE responding
3. VERIFY      â†’ No completion claims without fresh verification evidence
4. READ FIRST  â†’ Always read a file completely before modifying it
5. MAX 500 LOC â†’ Split files exceeding ~500 lines
6. NO DESTROY  â†’ No destructive git ops (reset --hard, push -f) without explicit permission
7. CONV COMMIT â†’ Use conventional commits: feat|fix|refactor|docs|test|chore
8. USER LANG   â†’ Respond in the user's language (code stays in English)
9. TESTS PASS  â†’ Tests must pass before merge/PR
10. NO SUPPRESS â†’ Never suppress linter warnings, fix root cause
```

---

## Agent Registry

| Emoji | Agent | Triggers |
|-------|-------|----------|
| ğŸ” | project-auditor | audit, review, analyze project |
| ğŸ¯ | tech-lead | plan, sprint, prioritize, delegate |
| ğŸ’» | developer | implement, fix, code, build, refactor |
| ğŸ”’ | security-hardener | security, vulnerability, harden, OWASP |
| âš¡ | performance-optimizer | performance, slow, optimize, latency |
| ğŸ§ª | test-engineer | test, coverage, unit test, e2e, TDD |
| ğŸ“ | docs-writer | document, readme, changelog, ADR |
| ğŸš€ | devops-engineer | deploy, CI/CD, docker, pipeline |
| â™¿ | accessibility-auditor | accessibility, a11y, WCAG, ARIA |
| ğŸ­ | orchestrator | parallel, dispatch, waves |
| ğŸ§¬ | agent-architect | evaluate agents, improve skills |
| ğŸ‘ï¸ | code-reviewer | PR review, code review |
| ğŸ”¬ | systematic-debugger | bug, debug, error, failing, broken |

**Activation workflow:**
1. Detect task type from keywords
2. Read `.agent/skills/{agent}/SKILL.md`
3. Follow skill instructions exactly
4. Start response: `[emoji agent-name] -- reason`

---

## Verification Protocol

```
BEFORE claiming completion:
1. IDENTIFY what command proves the claim
2. RUN the command (fresh, complete)
3. READ full output, check exit code
4. ONLY THEN make the claim with evidence

"Should work" = NOT verified
"Tests pass" without running tests = LYING
```

---

## Code Standards

- **Max 500 LOC per file** - refactor if exceeded
- **Conventional Commits**: `feat:`, `fix:`, `refactor:`, `docs:`, `test:`, `chore:`
- **No `any` types** - find or create proper types
- **Handle all error paths** - try/catch external calls
- **Match existing style** - don't introduce new patterns without approval

### Code Health (periodic)

Run these tools to detect technical debt:

```bash
# Find duplicate code blocks
npx jscpd src/

# Find unused exports, dependencies, files
npx knip
```

Recommend running after every 2-3 sprints or before major releases.

---

## Git Safety

**NEVER without explicit permission:**
- `git push --force`
- `git reset --hard`
- `git checkout .` / `git restore .`
- `git clean -f`
- `git branch -D`
- Amend commits

**ALWAYS:**
- Check `git status` and `git diff` before committing
- Use conventional commit format
- Keep changes small and reviewable

---

## Documentation Standard

**The Onboarding Test** - New team members should be able to:
- **5 min**: Understand what the project does
- **30 min**: Set up local development
- **2 hours**: Understand architecture, make first contribution
- **1 day**: Work independently

**Day 1 (required):** README.md, docs/SETUP.md, docs/ARCHITECTURE.md
**Week 1:** docs/STACK.md, docs/API.md, CHANGELOG.md
**Ongoing:** docs/adr/, docs/TROUBLESHOOTING.md

If docs don't pass the onboarding test, they're incomplete.

---

## Convergence Architecture (Optional)

Check if active:
- Beads: `[ -d ".beads" ] && command -v bd`
- Worktrees: `git worktree list`

**Model specialization:**
- Claude: Execution agents (developer, security, perf, tester, devops)
- Gemini: Planning + audit agents (auditor, tech-lead, orchestrator, architect)

All convergence features are optional - fall back to standard behavior if not configured.

---

## Parallel Execution (Worktrees)

**Why worktrees?** Running multiple agents in the same directory causes:
- File locking bugs (Claude Code v2.0.59+)
- CPU hangs with hooks (Claude Code v2.1.23+)
- Merge conflicts when agents touch same files
- Context contamination between agents

**Worktrees = isolated filesystem per agent. Zero conflicts.**

### Quick Reference

```bash
# Create worktree for a task
git worktree add .trees/feature-auth feature/authentication

# List active worktrees
git worktree list

# Remove after merge
git worktree remove .trees/feature-auth
```

### Parallel Workflow

```
1. Orchestrator creates worktrees:
   .trees/wave1-developer/   â†’ feature/login
   .trees/wave1-tester/      â†’ feature/login-tests
   .trees/wave1-docs/        â†’ feature/login-docs

2. Each agent works in isolation:
   cd .trees/wave1-developer && claude
   cd .trees/wave1-tester && claude
   cd .trees/wave1-docs && claude

3. Merge when complete:
   git checkout main
   git merge feature/login
   git merge feature/login-tests
   git merge feature/login-docs

4. Cleanup:
   git worktree remove .trees/wave1-developer
   git worktree remove .trees/wave1-tester
   git worktree remove .trees/wave1-docs
```

### Rules for Agents in Worktrees

- **Stay in your worktree** - never modify files outside it
- **One branch per worktree** - don't switch branches
- **Commit before stopping** - preserve work state
- **Signal completion** - use Beads or report to orchestrator

---

## Structure

```
.agent/              â† CANONICAL SOURCE (always edit here)
â”œâ”€â”€ AGENTS.MD        â† This file (global rules)
â””â”€â”€ skills/
    â””â”€â”€ {agent}/SKILL.md

.claude/skills/      â† SYMLINK to .agent/skills/
.gemini/skills/      â† SYMLINK to .agent/skills/ (if using Gemini)
```

Never edit in `.claude/` or `.gemini/` directly.

---

## Project Onboarding (New Projects)

When detecting a new project (no `.dev-errors.log`, no `.beads/`), suggest:
1. Dev observability setup
2. Skill recommendations from external repos
3. Beads initialization (if installed)

Never auto-install without asking.

---

## Periodic Evaluation

Trigger: "evaluate team", "retrospective", "review skills"

Evaluate:
- Skill activation accuracy
- Output quality
- Missing skills for project stack
- External repo updates

Report only - never auto-apply changes.

---

## IRON LAWS (Repeated for retention)

```
1. IDENTIFY    â†’ Start work responses with [emoji agent-name] -- reason
2. SKILL FIRST â†’ Read .agent/skills/{agent}/SKILL.md BEFORE responding
3. VERIFY      â†’ No completion claims without fresh verification evidence
4. READ FIRST  â†’ Always read a file completely before modifying it
5. MAX 500 LOC â†’ Split files exceeding ~500 lines
6. NO DESTROY  â†’ No destructive git ops (reset --hard, push -f) without explicit permission
7. CONV COMMIT â†’ Use conventional commits: feat|fix|refactor|docs|test|chore
8. USER LANG   â†’ Respond in the user's language (code stays in English)
9. TESTS PASS  â†’ Tests must pass before merge/PR
10. NO SUPPRESS â†’ Never suppress linter warnings, fix root cause
```

---

*Skills location: `.agent/skills/{agent-name}/SKILL.md`*
